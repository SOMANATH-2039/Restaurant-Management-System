{% extends "main.html" %}

{% block main %}
<div class="container mt-5">
    <h1>Order #{{ order.id }} Details</h1>
    <hr>
  
    <!-- Order Details -->
    <div class="row">
      <div class="col-md-6">
        <h4>Order Information</h4>
        <p><strong>User:</strong> <b>{{ order.user.username }}</b></p>
        <p><strong>Date Ordered:</strong> {{ order.date_ordered }}</p>
        <p><strong>Total Price:</strong> &#8377;{{ order.total_price }}</p>
        <p><strong>Status:</strong> {{ order.status }}</p>
        <p><strong>Payment Status:</strong> {% if order.is_paid %}Paid{% else %}Unpaid{% endif %}</p>
      </div>
  
      <div class="col-md-6">
        <h4>Manage Order</h4>
        <form action="{% url 'update_order_status' order.id %}" method="POST">
          {% csrf_token %}
          <div class="form-group">
            <label for="status">Update Status:</label>
            <select class="form-control" name="status" id="status">
              {% for status, display in order.STATUS_CHOICES %}
                <option value="{{ status }}" {% if order.status == status %}selected{% endif %}>
                  {{ display }}
                </option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Update Status</button>
        </form>
  
        <!-- Mark as Paid -->
        <form action="{% url 'mark_as_paid' order.id %}" method="POST" class="mt-3">
          {% csrf_token %}
          {% if not order.is_paid %}
            <button type="submit" class="btn btn-success">Mark as Paid</button>
          {% else %}
            <button type="button" class="btn btn-secondary" disabled>Already Paid</button>
          {% endif %}
        </form>
  
        <!-- Cancel Order -->
        <form action="{% url 'cancel_order' order.id %}" method="POST" class="mt-3">
          {% csrf_token %}
          {% if order.status != 'Cancelled' %}
            <button type="submit" class="btn btn-danger">Cancel Order</button>
          {% else %}
            <button type="button" class="btn btn-secondary" disabled>Order Cancelled</button>
          {% endif %}
        </form>
      </div>
    </div>
  
    <!-- Order Items -->
    <h4 class="mt-5">Order Items</h4>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Product</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for item in order.order_items.all %}
        <tr>
          <td>{{ item.product.name }}</td>
          <td>{{ item.quantity }}</td>
          <td>&#8377;{{ item.product.price }}</td>
          <td>&#8377;{{ item.total_price }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  
    <!-- Back to Orders List -->
    <a href="{% url 'order_list' %}" class="btn btn-secondary mt-4">Back to Orders List</a>
  </div>
  <br><br>
{% endblock main %}